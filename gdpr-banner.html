
<style>
	#GDPR-banner{
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		background-color: #f2f2f2;
		color: #131313;
		padding: 10px;
		border-top: 1px solid #ccc;
		z-index: 999;
	}
	#GDPR-optionContainer{
		display: flex;
		justify-content: center;
		align-items: center;
	}

</style>
<script>
function gdprBanner(){

	// keep track of pages (new session) and die
	if (sessionStorage.pageViews) ++sessionStorage.pageViews;
	else sessionStorage.pageViews = 1;
	if(sessionStorage.pageViews != 1) return;


	// Parameters

	// set options for what to track and what not to track see - https://developers.google.com/tag-platform/tag-manager/templates/consent-apis
	const checkbox = [
		{ option: "analytics_storage", display: "Analytics", default:'deny' },
		{ option: "personalization_storage", display: "Personalization", default:'deny' },
	]

	// Display a message to the users
	let message = "<h1>Hello! GDPR Banner!</h1><p>Privacy Notice: we are a GDPR compliant company</p>";


	// DO NOT MODIFY BELOW THIS LINE

	let prefix = "GDPR-";
	
	// console.log("hello world");
	// const updateConsentState = require('updateConsentState');

	// create banner and set styles
	const banner = document.createElement('div');
	banner.id = prefix+'banner';
	const textContainer = document.createElement('div');
	textContainer.innerHTML = message;
	const optionContainer = document.createElement('div')
	optionContainer.id = prefix + 'bannerOptions';

	banner.style = `
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		background-color: #f2f2f2;
		color: #131313;
		padding: 10px;
		border-top: 1px solid #ccc;
		z-index: 999;
	`;
	optionContainer.style = `
		display: flex;
		justify-content: center;
		align-items: center;
	`;


	// Create and Add tracking options
	for(check of checkbox){
		let option = document.createElement("input");
		let label = document.createElement("label");

		option.type = 'checkbox';
		option.id = prefix + check['option'];
		option.checked = "checked"
		
		label.setAttribute("for", prefix + check['option'])
		label.textContent = check['display'];

		optionContainer.appendChild(label);
		optionContainer.appendChild(option);
	}


	// Accept all button, this will allow all tracking
	const acceptButton = document.createElement('button');
	acceptButton.textContent = 'Accept All';
	acceptButton.onclick = function(){
		console.log("All Accepted");

		googleConsentStates = {};
		for(choice of checkbox){
			googleConsentStates[choice["option"]] = 'granted';
		}
		// updateConsentState(googleConsentStates);
		console.log(googleConsentStates);
	};
	

	// Confirm choices button, this will save the choices made.
	const confirmButton = document.createElement('button');
	confirmButton.textContent = 'Confirm Choice';
	confirmButton.onclick = function(){
		console.log("Choices Confirmed");

		googleConsentStates = {};
		for(choice of checkbox){
			googleConsentStates[choice["option"]] = (document.getElementById(prefix+choice['option']).checked ? 'granted' : 'denied');
		}
		// updateConsentState(googleConsentStates);
		console.log(googleConsentStates);
		
	};


	// add select option buttons to banner
	optionContainer.appendChild(confirmButton);
	optionContainer.appendChild(acceptButton);

	// add the selection section to the banner
	banner.appendChild(textContainer);
	banner.appendChild(optionContainer);

	// put it all together
	document.body.appendChild(banner);
}
	
gdprBanner();
</script>
