<style>
	#GDPR-banner{
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		background-color: #068DA1;
		color: white;
		padding: 10px;
		border-top: 1px solid #ccc;
		z-index: 999;
	}
	#GDPR-optionContainer{
		display: flex;
		justify-content: center;
		align-items: center;
	}
	.GDPR-check-container{
		padding:0 1em 0 1em;
	}
	.GDPR-btn{
		margin: 0 1em;
		padding: 5pt;

	}

</style>
<script>
function gdprBanner(){

	// keep track of pages (new session) and die
	// if (sessionStorage.pageViews) ++sessionStorage.pageViews;
	// else sessionStorage.pageViews = 1;
	// if(sessionStorage.pageViews != 1) return;

	// const updateConsentState = require('updateConsentState');


	// Parameters

	// set options for what to track and what not to track see - https://developers.google.com/tag-platform/tag-manager/templates/consent-apis
	var checkbox = [
		{ option: "analytics_storage", display: "Analytics", default:'deny' },
		{ option: "personalization_storage", display: "Personalization", default:'deny' },
	]
	

	// Display a message to the users
	var message = "";
	message += "<div style='text-align:center;'>";
	message += "<p>We use cookies on our website to provide you with the best experience possible. If you continue browsing, you consent to the use of these cookies.<a href='https://reasons.org/privacy-policy'> Read More</a></p>";
	message += "</div>";

	// DO NOT MODIFY BELOW THIS LINE

	var prefix = "GDPR-";

	
	// Accept all button, this will allow all tracking
	var acceptButton = document.createElement('button');
	acceptButton.className = "GDPR-btn";
	acceptButton.textContent = 'Accept All';
	acceptButton.onclick = function () {
		console.log("All Accepted");

		var googleConsentStates = {};
		for (x in checkbox) {
			choice = checkbox[x];
			googleConsentStates[choice["option"]] = 'granted';
		}
		// updateConsentState(googleConsentStates);
		console.log(googleConsentStates);
	};


	// Confirm choices button, this will save the choices made.
	var confirmButton = document.createElement('button');
	confirmButton.className = "GDPR-btn";
	confirmButton.textContent = 'Confirm Choice';
	confirmButton.onclick = function () {
		console.log("Choices Confirmed");

		var googleConsentStates = {};
		for (x in checkbox) {
			var choice = checkbox[x];
			googleConsentStates[choice["option"]] = (document.getElementById(prefix + choice['option']).checked ? 'granted' : 'denied');
		}
		// updateConsentState(googleConsentStates);
		console.log(googleConsentStates);

	};

	// Deny All Button, This will deny all options
	var closeButton = document.createElement('div');
	closeButton.style = "text-align:right"
	var closeLink = document.createElement('button');
	closeLink.textContent = 'X';
	
	closeLink.onclick = function () {
		console.log("Yeet");
		var googleConsentStates = {}
		for (x in checkbox) {
			var choice = checkbox[x];
			googleConsentStates[choice["option"]] = 'denied';
		}
		
		// updateConsentState(googleConsentStates);
		console.log(googleConsentStates);
	}
	closeButton.appendChild(closeLink);


	// create banner and set styles
	var banner = document.createElement('div');
	banner.id = prefix+'banner';
	var textContainer = document.createElement('div');
	
	textContainer.appendChild(closeButton);
	textContainer.innerHTML += message;

	
	var optionContainer = document.createElement('div')
	optionContainer.id = prefix + 'bannerOptions';


	// These styles are to be removed when put into google tag manager
	banner.style = `
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		background-color: #068DA1;
		color: white;
		padding: 10px;
		border-top: 1px solid #ccc;
		z-index: 999;
	`;
	optionContainer.style = `
		display: flex;
		justify-content: center;
		align-items: center;
	`;


	// Create and Add tracking options
	for(x in checkbox){
		check = checkbox[x];
		var group = document.createElement("div");
		var option = document.createElement("input");
		var label = document.createElement("label");

		var innerCSS = `
			padding: 0 1em 0 1em;
		`
		group.style = innerCSS;
		// label.style = innerCSS;

		group.className = prefix+'check-container'

		option.type = 'checkbox';
		option.id = prefix + check['option'];
		option.checked = "checked"

		
		label.setAttribute("for", prefix + check['option'])
		label.textContent = check['display']+" ";

		group.appendChild(label);
		group.appendChild(option);
		optionContainer.appendChild(group);
	}



	// add select option buttons to banner
	optionContainer.appendChild(confirmButton);
	optionContainer.appendChild(acceptButton);

	// add the selection section to the banner
	banner.appendChild(textContainer);
	banner.appendChild(optionContainer);

	// put it all together
	document.body.appendChild(banner);
}
	
gdprBanner();
</script>
